--[[
    Executor Chat GUI
    Features: Draggable, Minimizable, Closable, Online Chat
    For educational purposes
]]

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CONFIGURATION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CONFIG = {
    -- For online chat, use a webhook or custom server
    WEBHOOK_URL = "https://canary.discord.com/api/webhooks/1453086730323361833/lAG1hkKi72WaMydW8WnQsFVO3ZLhla4wXLJiPtofckqtbOAn5ElimnYLylE3eQEaVd-W", -- Discord webhook URL (send only)
    CHAT_API_URL = "", -- Custom API for full chat (optional)
    POLL_INTERVAL = 3, -- Seconds between checking for new messages
    MAX_MESSAGES = 50, -- Max messages to keep in chat
    CHAT_ID = "global", -- Chat room ID
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CREATE GUI
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Destroy existing GUI if present
if playerGui:FindFirstChild("ExecutorChatGUI") then
    playerGui:FindFirstChild("ExecutorChatGUI"):Destroy()
end

-- Screen GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ExecutorChatGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = playerGui

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 220)
MainFrame.Position = UDim2.new(0, 15, 0.5, -110)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(60, 60, 70)
MainStroke.Thickness = 1
MainStroke.Parent = MainFrame

-- Drop Shadow (optional visual)
local Shadow = Instance.new("ImageLabel")
Shadow.Name = "Shadow"
Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
Shadow.BackgroundTransparency = 1
Shadow.Position = UDim2.new(0.5, 0, 0.5, 4)
Shadow.Size = UDim2.new(1, 20, 1, 20)
Shadow.ZIndex = -1
Shadow.Image = "rbxassetid://6015897843"
Shadow.ImageColor3 = Color3.new(0, 0, 0)
Shadow.ImageTransparency = 0.5
Shadow.ScaleType = Enum.ScaleType.Slice
Shadow.SliceCenter = Rect.new(49, 49, 450, 450)
Shadow.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 28)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

-- Fix bottom corners of title bar
local TitleFix = Instance.new("Frame")
TitleFix.Size = UDim2.new(1, 0, 0, 12)
TitleFix.Position = UDim2.new(0, 0, 1, -12)
TitleFix.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TitleFix.BorderSizePixel = 0
TitleFix.Parent = TitleBar

-- Status Indicator
local StatusDot = Instance.new("Frame")
StatusDot.Name = "StatusDot"
StatusDot.Size = UDim2.new(0, 8, 0, 8)
StatusDot.Position = UDim2.new(0, 10, 0.5, -4)
StatusDot.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
StatusDot.BorderSizePixel = 0
StatusDot.Parent = TitleBar

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(1, 0)
StatusCorner.Parent = StatusDot

-- Title Text
local TitleText = Instance.new("TextLabel")
TitleText.Name = "Title"
TitleText.Size = UDim2.new(1, -80, 1, 0)
TitleText.Position = UDim2.new(0, 24, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "ğŸ’¬ Chat"
TitleText.TextColor3 = Color3.fromRGB(220, 220, 230)
TitleText.TextSize = 13
TitleText.Font = Enum.Font.GothamBold
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 22, 0, 22)
CloseButton.Position = UDim2.new(1, -27, 0, 3)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 11
CloseButton.Font = Enum.Font.GothamBold
CloseButton.AutoButtonColor = false
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 22, 0, 22)
MinimizeButton.Position = UDim2.new(1, -52, 0, 3)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(220, 160, 40)
MinimizeButton.Text = "âˆ’"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 14
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.AutoButtonColor = false
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

-- Content Container
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -28)
ContentFrame.Position = UDim2.new(0, 0, 0, 28)
ContentFrame.BackgroundTransparency = 1
ContentFrame.ClipsDescendants = true
ContentFrame.Parent = MainFrame

-- Chat Messages ScrollingFrame
local ChatScroll = Instance.new("ScrollingFrame")
ChatScroll.Name = "ChatScroll"
ChatScroll.Size = UDim2.new(1, -12, 1, -42)
ChatScroll.Position = UDim2.new(0, 6, 0, 6)
ChatScroll.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
ChatScroll.BorderSizePixel = 0
ChatScroll.ScrollBarThickness = 3
ChatScroll.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 100)
ChatScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
ChatScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
ChatScroll.Parent = ContentFrame

local ChatScrollCorner = Instance.new("UICorner")
ChatScrollCorner.CornerRadius = UDim.new(0, 8)
ChatScrollCorner.Parent = ChatScroll

local ChatLayout = Instance.new("UIListLayout")
ChatLayout.SortOrder = Enum.SortOrder.LayoutOrder
ChatLayout.Padding = UDim.new(0, 3)
ChatLayout.Parent = ChatScroll

local ChatPadding = Instance.new("UIPadding")
ChatPadding.PaddingLeft = UDim.new(0, 8)
ChatPadding.PaddingRight = UDim.new(0, 8)
ChatPadding.PaddingTop = UDim.new(0, 6)
ChatPadding.PaddingBottom = UDim.new(0, 6)
ChatPadding.Parent = ChatScroll

-- Input Container
local InputContainer = Instance.new("Frame")
InputContainer.Name = "InputContainer"
InputContainer.Size = UDim2.new(1, -12, 0, 30)
InputContainer.Position = UDim2.new(0, 6, 1, -36)
InputContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
InputContainer.BorderSizePixel = 0
InputContainer.Parent = ContentFrame

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 6)
InputCorner.Parent = InputContainer

-- Text Input
local InputBox = Instance.new("TextBox")
InputBox.Name = "InputBox"
InputBox.Size = UDim2.new(1, -40, 1, 0)
InputBox.Position = UDim2.new(0, 0, 0, 0)
InputBox.BackgroundTransparency = 1
InputBox.Text = ""
InputBox.PlaceholderText = "Type message..."
InputBox.TextColor3 = Color3.fromRGB(230, 230, 240)
InputBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 120)
InputBox.TextSize = 12
InputBox.Font = Enum.Font.Gotham
InputBox.TextXAlignment = Enum.TextXAlignment.Left
InputBox.ClearTextOnFocus = false
InputBox.Parent = InputContainer

local InputBoxPadding = Instance.new("UIPadding")
InputBoxPadding.PaddingLeft = UDim.new(0, 10)
InputBoxPadding.Parent = InputBox

-- Send Button
local SendButton = Instance.new("TextButton")
SendButton.Name = "SendButton"
SendButton.Size = UDim2.new(0, 30, 0, 22)
SendButton.Position = UDim2.new(1, -34, 0.5, -11)
SendButton.BackgroundColor3 = Color3.fromRGB(70, 130, 220)
SendButton.Text = "â¤"
SendButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SendButton.TextSize = 12
SendButton.Font = Enum.Font.GothamBold
SendButton.AutoButtonColor = false
SendButton.Parent = InputContainer

local SendCorner = Instance.new("UICorner")
SendCorner.CornerRadius = UDim.new(0, 5)
SendCorner.Parent = SendButton

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- VARIABLES & STATE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local isMinimized = false
local originalSize = MainFrame.Size
local dragging = false
local dragStart = nil
local startPos = nil
local messageCount = 0
local lastMessageId = 0

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- HTTP Request wrapper (works with most executors)
local function httpRequest(options)
    local request = (syn and syn.request) or (http and http.request) or http_request or request or fluxus and fluxus.request
    if request then
        return request(options)
    end
    return nil
end

-- Add message to chat
local function addMessage(username, message, msgColor, isSystem)
    messageCount = messageCount + 1
    
    local msgFrame = Instance.new("Frame")
    msgFrame.Name = "Message_" .. messageCount
    msgFrame.Size = UDim2.new(1, 0, 0, 0)
    msgFrame.AutomaticSize = Enum.AutomaticSize.Y
    msgFrame.BackgroundTransparency = 1
    msgFrame.LayoutOrder = messageCount
    msgFrame.Parent = ChatScroll
    
    local color = msgColor or Color3.fromRGB(100, 180, 255)
    
    local msgLabel = Instance.new("TextLabel")
    msgLabel.Size = UDim2.new(1, 0, 0, 0)
    msgLabel.AutomaticSize = Enum.AutomaticSize.Y
    msgLabel.BackgroundTransparency = 1
    msgLabel.RichText = true
    
    if isSystem then
        msgLabel.Text = string.format('<font color="rgb(%d,%d,%d)">%s</font>', 
            math.floor(color.R * 255), 
            math.floor(color.G * 255), 
            math.floor(color.B * 255), 
            message)
    else
        msgLabel.Text = string.format('<font color="rgb(%d,%d,%d)">[%s]</font>: %s', 
            math.floor(color.R * 255), 
            math.floor(color.G * 255), 
            math.floor(color.B * 255), 
            username, 
            message)
    end
    
    msgLabel.TextColor3 = Color3.fromRGB(200, 200, 210)
    msgLabel.TextSize = 11
    msgLabel.Font = Enum.Font.Gotham
    msgLabel.TextXAlignment = Enum.TextXAlignment.Left
    msgLabel.TextWrapped = true
    msgLabel.Parent = msgFrame
    
    -- Clean old messages
    local children = ChatScroll:GetChildren()
    local messageFrames = {}
    for _, child in pairs(children) do
        if child:IsA("Frame") and child.Name:match("^Message_") then
            table.insert(messageFrames, child)
        end
    end
    
    if #messageFrames > CONFIG.MAX_MESSAGES then
        table.sort(messageFrames, function(a, b)
            return a.LayoutOrder < b.LayoutOrder
        end)
        messageFrames[1]:Destroy()
    end
    
    -- Scroll to bottom
    task.defer(function()
        ChatScroll.CanvasPosition = Vector2.new(0, ChatScroll.AbsoluteCanvasSize.Y)
    end)
end

-- Send message
local function sendMessage(text)
    if text == "" or text:match("^%s*$") then return end
    
    local username = player.Name
    
    -- Add locally first
    addMessage(username, text, Color3.fromRGB(80, 200, 255))
    
    -- Send to webhook if configured
    if CONFIG.WEBHOOK_URL ~= "" then
        task.spawn(function()
            pcall(function()
                httpRequest({
                    Url = CONFIG.WEBHOOK_URL,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = HttpService:JSONEncode({
                        content = string.format("**[%s]**: %s", username, text),
                        username = "Executor Chat | " .. game.PlaceId
                    })
                })
            end)
        end)
    end
    
    -- Send to custom API if configured
    if CONFIG.CHAT_API_URL ~= "" then
        task.spawn(function()
            pcall(function()
                httpRequest({
                    Url = CONFIG.CHAT_API_URL .. "/send",
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = HttpService:JSONEncode({
                        username = username,
                        message = text,
                        chatId = CONFIG.CHAT_ID,
                        gameId = game.PlaceId
                    })
                })
            end)
        end)
    end
end

-- Poll for messages (if using custom API)
local function pollMessages()
    if CONFIG.CHAT_API_URL == "" then return end
    
    task.spawn(function()
        while ScreenGui.Parent do
            pcall(function()
                local response = httpRequest({
                    Url = CONFIG.CHAT_API_URL .. "/messages?chatId=" .. CONFIG.CHAT_ID .. "&after=" .. lastMessageId,
                    Method = "GET"
                })
                
                if response and response.Body then
                    local data = HttpService:JSONDecode(response.Body)
                    for _, msg in ipairs(data.messages or {}) do
                        if msg.username ~= player.Name then
                            addMessage(msg.username, msg.message, Color3.fromRGB(220, 180, 80))
                        end
                        lastMessageId = math.max(lastMessageId, msg.id or 0)
                    end
                end
            end)
            task.wait(CONFIG.POLL_INTERVAL)
        end
    end)
end

-- Button hover effect
local function setupHover(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = hoverColor}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = normalColor}):Play()
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DRAGGING SYSTEM
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + delta.X, 
            startPos.Y.Scale, 
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- BUTTON EVENTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Close Button
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Minimize Button
MinimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    
    local targetSize = isMinimized and UDim2.new(0, 280, 0, 28) or originalSize
    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    
    TweenService:Create(MainFrame, tweenInfo, {Size = targetSize}):Play()
    
    MinimizeButton.Text = isMinimized and "+" or "âˆ’"
    ContentFrame.Visible = not isMinimized
end)

-- Send Button
SendButton.MouseButton1Click:Connect(function()
    sendMessage(InputBox.Text)
    InputBox.Text = ""
end)

-- Input Box Enter
InputBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        sendMessage(InputBox.Text)
        InputBox.Text = ""
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- HOVER EFFECTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
setupHover(CloseButton, Color3.fromRGB(220, 60, 60), Color3.fromRGB(255, 80, 80))
setupHover(MinimizeButton, Color3.fromRGB(220, 160, 40), Color3.fromRGB(255, 190, 60))
setupHover(SendButton, Color3.fromRGB(70, 130, 220), Color3.fromRGB(90, 150, 255))

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- INITIALIZE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Welcome messages
addMessage("System", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", Color3.fromRGB(80, 80, 100), true)
addMessage("System", "Welcome to Executor Chat!", Color3.fromRGB(120, 220, 120), true)
addMessage("System", "Player: " .. player.Name, Color3.fromRGB(180, 180, 200), true)
addMessage("System", "Game: " .. game.PlaceId, Color3.fromRGB(180, 180, 200), true)

if CONFIG.WEBHOOK_URL == "" and CONFIG.CHAT_API_URL == "" then
    addMessage("System", "âš  No server configured (local only)", Color3.fromRGB(255, 180, 80), true)
else
    addMessage("System", "âœ“ Online mode enabled", Color3.fromRGB(120, 220, 120), true)
    pollMessages()
end

addMessage("System", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", Color3.fromRGB(80, 80, 100), true)

-- Toggle with keybind (optional)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.RightControl then
        MainFrame.Visible = not MainFrame.Visible
    end
end)

print("[Executor Chat] Loaded successfully! Press Right-Ctrl to toggle.")